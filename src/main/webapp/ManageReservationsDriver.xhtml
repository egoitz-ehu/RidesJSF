<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	template="/WEB-INF/facelets/templates/Txantiloia.xhtml">
	
	<ui:define name="styles">
		<h:outputStylesheet library="css" name="reservationStates.css" />
	</ui:define>

	<ui:define name="content">
		<f:event type="postAddToView"
			listener="#{languageBean.initializeLocaleForView}" />
		<h:form>
			<p:dataTable id="reservationTable" var="reservation"
				value="#{manageReservationsDriverBean.reservations}"
				sortBy="#{reservation.ride.id}"
				emptyMessage="#{msg['manageBookingDriver.empty']}">

				<p:headerRow field="ride.id" expandable="true">
					<p:column>
						<div class="inline-flex align-items-center"
							style="vertical-align: middle">
							<h:outputText styleClass="ml-2"
								value="#{reservation.ride.departingCity} â†’ #{reservation.ride.arrivalCity} (#{reservation.ride.rideDate})">
								<f:convertDateTime pattern="yyyy-MM-dd" />
							</h:outputText>
						</div>
					</p:column>
				</p:headerRow>

				<p:column headerText="#{msg['manageBookingDriver.date']}">
					<h:outputText value="#{reservation.createDate}">
						<f:convertDateTime pattern="yyyy-MM-dd" />
					</h:outputText>
				</p:column>

				<p:column headerText="#{msg['manageBookingDriver.places']}">
					<h:outputText value="#{reservation.nPlaces}" />
				</p:column>

				<p:column headerText="#{msg['manageBookingDriver.totalPrice']}">
					<h:outputText value="#{reservation.totalPrice}" />
				</p:column>

				<p:column headerText="#{msg['manageBookingDriver.traveler']}">
					<h:outputText value="#{reservation.traveler.name}" />
				</p:column>

				<p:column headerText="#{msg['manageBookingDriver.status']}">
					<h:panelGroup rendered="#{reservation.state=='WAITING'}">
						<div style="display: flex; gap: 0.5rem;">
							<p:commandButton icon="pi pi-check"
								styleClass="p-button p-button-rounded"
								style="background-color: #2ecc71; border-color: #2ecc71;"
								action="#{manageReservationsDriverBean.accept(reservation)}"
								update="reservationTable" title="Aceptar" />

							<p:commandButton icon="pi pi-times"
								styleClass="p-button p-button-rounded"
								style="background-color: #e74c3c; border-color: #e74c3c;"
								action="#{manageReservationsDriverBean.reject(reservation)}"
								update="reservationTable" title="Rechazar" />
						</div>
					</h:panelGroup>

					<h:panelGroup rendered="#{reservation.state!='WAITING'}">
						<h:outputText value="#{msg['status.' += reservation.state]}"
							styleClass="state-box #{reservation.state == 'ACCEPTED' ? 'state-accepted' : (reservation.state == 'REJECTED' ? 'state-rejected' : '')}" />
					</h:panelGroup>
				</p:column>
			</p:dataTable>
		</h:form>
	</ui:define>
</ui:composition>
